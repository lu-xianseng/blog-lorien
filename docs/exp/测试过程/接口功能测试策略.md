---
Author: 海针
---
# 接口功能测试策略


## 接口文档

作为测试强依赖项，接口测试用例的设计与测试都基于接口文档完成。

特别是我们要在`接口测试`提测前，需要完成`接口用例`的编写，如果接口文档质量过差，会导致增加巨大的沟通成本、降低效率，甚至没办法提前完成用例编写，提测时还要一边抓包，一边测试，一边确认，所以接口文档应该纳入测试范围。



## 测试范围

目前已与项目组达成约定，接口测试分为：

* 接口文档测试：接口用例设计与编写前阶段进行，主要验证接口文档包含的信息是否完整。
* 接口功能测试：作为功能测试提测准入条件，目前只做增量测试，例如本期新需求设计的新增接口、历史接口参数/逻辑修改等。



### 接口文档测试

主要针对接口相关的描述，验证是否满足约定规范，一般涉及`接口参数详情`、`新增接口`、`接口修改`。

#### 文档内容规范

* 接口参数详情，需包含：
  * 参数名称
  * 参数类型：integer/string/boolean
  * 是否必传：带[*****]号则必传
  * 长度限制：例如不超过50字符
  * 输入限制与对应功能（例如）：
    *  `string` 类型，不允许输入特殊符号`|/\*:"'?<>`
    * `integer` 类型，只允许输入`[0 1]`，传0 表示 xxx，传1 表示 xxx。
    * `boolean` 类型，传 `True` 表示 xxx，传 `Flase` 表示 xxx。

* 新增接口，描述需包含：
  * 接口主要实现的功能作用。
  * 接口的使用场景，什么时候会调用，产生什么作用。
  * 是否与其他接口存在业务关联，具体描述逻辑部分。
  * 新增参数详情
  * 新增入参 `json` 示例（RequestBody）
* 接口修改，描述需包含：
  * 接口修改后与修改前的功能、逻辑差异。
  * 接口若与其他接口存在业务关联，存在的逻辑修改部分具体描述。
  * 新增/修改参数详情
  * 新增/修改入参 `json` 示例（RequestBody）

#### 文档接口参数约定

接口实际请求的参数会存在与接口文档不一致的情况，重点！重点！重点！

参数的校验，一律以接口文档为准，**接口文档不包含的参数，不在测试范围内。**

备注：达成一致详情见  [Bug链接](https://pms.uniontech.com/bug-view-188067.html)



#### 接口文档问题示例

```
admin/....../logout接口

接口文档对该接口的描述：
账户登出。

测试人员想要看到的示例：
前端退出登陆时会调用该接口，调用后当前用户token失效，实现账号登出。
该接口支持传递可选参数（自定义镜像ID），实现退出账号的同时，把当前账号下自定义镜像上传中任务状态扭转为失败。
```

````
admin/....../upload接口，status参数

接口文档对该接口的描述：
integer

测试人员想要看到的示例：
该参数为必填参数，支持传入整型（integer），但仅支持传递[0 1]，传递0时代表镜像禁用，传递1时代表镜像启用。
````

备注：错误示例可直接提交Bug跟进。



#### 通过标准

内容符合**文档约定规范**，能基于接口文档内容完成接口测试用例的设计、编写工作，即为通过。



### 接口功能测试

在接口测试中最重要的部分是入参，因为一个接口的返回结果取决于请求参数，所以用例的设计都是围绕入参展开。一般分为三个部分：参数校验、返回值校验、逻辑校验。

#### 参数校验

​		![](/接口功能测试策略_assets/1.png)																								图3 接口文档示例

在接口测试的过程中，有一个最重要的参照物：接口文档，会作为我们设计用例和测试的标准，如上图标注了接口`/lc/findNearBySite`的所有参数，其中参数大致包含以下信息：

* 参数名称
* 参数类型
* 是否必传
* 长度限制

基于以上信息对参数进行用例设计，从参数组合的角度，尽可能多的覆盖参数组合场景，例如必填参数缺失、参数类型错误等。



#### 返回值校验

该测试同样依赖于接口文档，主要用于对接口请求的返回值进行校验，一般包括：

* 状态码：200、1001、1002、1010等，一般成功为200
* 返回字段：字段与接口文档一致，不会缺失或多余



#### 逻辑校验

该类型基于业务逻辑，需要结合场景进行测试，例如 `OEM` 平台，内网激活与产线激活2个定制项是互斥的，在前端是做了限制启用其中一个定制，另外一个定制自动置灰。但是在接口测试中可以通过入参同时启用这2个定制，如果能定制成功则说明不符合业务逻辑，理应收货一枚`Bug`。

除此之外部分参数的值在业务逻辑上做了特殊的校验，例如某传递 `IP` 的参数，限制值为字符串，但是对字符串的实际值也会做进一步判断，是否是一个正确的 `IP` 地址，此时就可以基于 `IP` 地址特性设计入参，如：

* 10.8.3
* 10.8.13257
* 52.6.13.22
* ......



## 接口用例

### 用例编写过程

用例编写过程中主要基于`接口文档`，但是也可以让研发同学搭建开发环境，让咱们可以对开发完成的接口进行实质性的请求、抓包操作，使用例编写更准确与便捷。

### 用例固定关键字

用例的编写固定格式，主要分为三个板块：

* 前置条件

  * 请求URL：接口地址
  * 请求方法：get/post/......
  * 请求头：{"token":  "xxxxx"} （是否有特殊意义）

* 步骤

  * 请求数据：完整的入参 json 数据

    *特殊情况：如果涉及定制镜像接口 `/web/v1/iso/solution`，入参会特别长，仅突出测试部分即可，前后使用 `......` 略过，如`图4`所示。*

* 预期

  * 响应数据：完整的响应 json 数据，若数据过长突出重点即可。



注意：请求头中 `{"token":  "xxxxx"}` 为固定内容，主要是`（）`中的内容，需要标注特别的前置条件意义，例如对应 `token` 用户包含 `xxx` 权限。

![](/接口功能测试策略_assets/2.png)

​																			图4 用例关键字示例



这么设计格式的目的是，若完成较好，理想状态下流程应该是：

* 接口用例编写完成
* 接口测试提测：
  * 粘贴pms用例步骤中`请求数据`，至接口测试工具(Postman、Jmeter...)即可完成请求
  * 基于pms用例预期，校验返回值
* 完成接口测试后，pms文本用例进行微调修改，与实际达到一致
* 基于pms用例请求数据与响应数据，自动化团队完成自动化转换
* 后续在需求未变化前，都基于自动化完成接口质量保障

